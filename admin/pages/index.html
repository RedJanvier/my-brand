<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Dashboard page for the admin of RedBlog site"
    />
    <meta name="author" content="RedJanvier" />
    <link rel="stylesheet" href="../../css/styles.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
      integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
      crossorigin="anonymous"
    />
    <title>Dashboard</title>
  </head>
  <body>
    <div class="loading">
      <div class="lds-ring">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="container">
      <nav class="navbar">
        <h1 class="navbar__logo">RedJanvier</h1>
        <ul class="navbar__links">
          <li><a href="#" class="active">Dashboard</a></li>
          <li><a href="./create.html">Create</a></li>
          <li><a href="./queries.html">Queries</a></li>
          <li><a href="./portfolio.html">Portfolio</a></li>
          <li>
            <div class="author__profile">
              <img src="/assets/img/blank_avatar.png" />
            </div>
          </li>
        </ul>
        <div class="profile-drop hide fade">
          <ul>
            <li><a href="./profile.html">Edit Profile</a></li>
            <li><button class="btn" id="logout-btn">Logout</button></li>
          </ul>
        </div>
        <div class="mobile">
          <a href="#0"><i class="fa fa-bars"></i></a>
          <ul class="navbar__mobile">
            <li><a href="#" class="active">Dashboard</a></li>
            <li><a href="./create.html">Create</a></li>
            <li><a href="./queries.html">Queries</a></li>
            <li><a href="./portfolio.html">Portfolio</a></li>
            <li><a href="./profile.html">Edit Profile</a></li>
            <li><button class="btn" id="logout-btn">Logout</button></li>
          </ul>
        </div>
      </nav>
      <main class="admin section colored">
        <div class="container">
        <p class="section__subheading">
          Here is what your followers are saying to you.
        </p>
        <div class="queries grid">
          <div class="comment card purple">
            <div class="card__column"><i class="fa fa-eye fs"></i><span class="fs views">923</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Views</h3>
                    <p class="left">
                      Eyes on blog
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="comment card green">
            <div class="card__column"><i class="fa fa-globe fs"></i><span class="fs subscribers">93</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Subscribers</h3>
                    <p class="left">
                      Mail subscriptions
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="comment card orange">
            <div class="card__column"><i class="fa fa-commenting-o fs"></i><span class="fs comments">34</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Comments</h3>
                    <p class="left">
                      Blog comments
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="comment card pink">
            <div class="card__column"><i class="fa fa-heart-o fs"></i><span class="fs likes">87</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Likes</h3>
                    <p class="left">
                      Blog likes
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="comment card red">
            <div class="card__column"><i class="fa fa-envelope-o fs"></i><span class="fs queries">43</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Queries</h3>
                    <p class="left">
                      Questions and Queries
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="comment card blue">
            <div class="card__column"><i class="fa fa-cog fs"></i><span class="fs projects">5</span></div>
            <div class="card__column">
              <div class="top">
                <div class="author">
                  <div class="author__details">
                    <h3>Projects</h3>
                    <p class="left">
                      Portfolio projects
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <section id="blog" class="section">
        <h2 class="section__heading">List of your blogs</h2>
        <p class="section__subheading">Latest posts from my blog.</p>
        <div class="blogs grid"></div>
      </section>
      <hr class="section-separator">
      <section class="section">
        <h2 class="section__heading">Portfolio</h2>
        <div class="blogs grid portfolio"></div>
      </section>
      <section class="section colored">
        <h2 class="section__heading">Activities</h2>
        <div class="grid">
          <div class="card">
            <canvas id="myChart"></canvas>
          </div>
          <div class="card">
            <canvas id="myChart1"></canvas>
          </div>
          <div class="card">
            <canvas id="myChart2"></canvas>
          </div>
        </div>
      </section>
    </div>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-analytics.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="../../js/init.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/utils.js"></script>
    <script src="../../js/navbar.js"></script>
    <script>
      let totalViews = 0;
      let totalLikes = 0;
      let totalQueries = 0;
      let totalProjects = 0;
      let totalComments = 0;
      const db = firebase.firestore();
      const blogs = document.querySelector(".blogs");
      db.collection("posts").orderBy("createdAt", "desc").onSnapshot(docs => {
        let html = '';
        docs.forEach(doc => {
          const blog = doc.data();
          totalComments += blog.comments;
          totalViews += blog.views;
          totalLikes += blog.likes;
          html += `<a href="../../pages/blog.html?id=${doc.id}" class="card">
            <div class="card__column-top">
              <div class="card__image">
                <img src="${blog.image}" alt="post-image" />
              </div>
              <h3>
               ${blog.title}
              </h3>
            </div>
            <div class="card__column-footer">
              <span><i class="fa fa-heart-o"></i> ${blog.likes || 0}</span>
              <span><i class="fa fa-commenting-o"></i> ${blog.comments || 0}</span>
              <span><i class="fa fa-eye"></i> ${blog.views || 0}</span>
            </div>
          </a>`
        });
        blogs.innerHTML = html;
      });
      db.collection("queries").onSnapshot(snaps => {
        snaps.forEach(snap => totalQueries++);
      })
      db.collection("projects").orderBy("createdAt", "desc").onSnapshot(docs => {
        let html = '';
        docs.forEach(doc => {
          const project = doc.data();
          totalProjects ++;
          html += `
          <div class="card">
            <div class="card__column"><div class="card__column-top">
              <img src="${project.image}">
              <h3>${project.title}</h3>
            </div>
            <div class="card__column-footer">
                
                <span><button class="btn" onclick="deleteProject('${doc.id}')"><i class="fa fa-trash-o"></i> Delete</button></span>
              </div>
            </div>
          </div>`
        });
        document.querySelector(".portfolio.blogs.grid").innerHTML = html;
      document.querySelector("span.fs.queries").textContent = totalQueries
        document.querySelector("span.fs.comments").textContent = totalComments
        document.querySelector("span.fs.likes").textContent = totalLikes
        document.querySelector("span.fs.views").textContent = totalViews
        document.querySelector("span.fs.projects").textContent = totalProjects
        disableLoader();
      });
        function deleteProject(id) {
          const result = confirm("Want to delete project ?")
          result && db.collection("projects").doc(id).delete().catch(console.log);
        }
      const ctx = document.getElementById('myChart').getContext('2d');
      const ctx1 = document.getElementById('myChart1').getContext('2d');
      const ctx2 = document.getElementById('myChart2').getContext('2d');
      const data =  {
              labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
              datasets: [{
                  label: 'My First dataset',
                  backgroundColor: 'rgb(155, 299, 202)',
                  borderColor: 'rgb(55, 78, 212)',
                  data: [0, 10, 5, 2, 20, 30, 45]
              }]
          }
      const chart = new Chart(ctx, {
          type: 'line',
          data,
          options: {}
      });
      const chart1 = new Chart(ctx1, {
          type: 'bar',
          data,
          options: {}
      });
      const chart2 = new Chart(ctx2, {
          type: 'pie',
          data,
          options: {}
      });
    </script>
  </body>
</html>
