<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Login page for the admin of RedBlog site"
    />
    <meta name="author" content="RedJanvier" />
    <link rel="stylesheet" href="../css/styles.css" />
    <title>Login</title>
  </head>
  <body>
    <div class="loading">
      <div class="lds-ring">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <main class="login section dark">
      <div class="container">
        <div class="card straight">
          <div class="card__column">
            <img src="../img/undraw_Fingerprint_re_uf3f.svg" />
          </div>
          <div class="card__column">
            <form class="form login-form">
              <div id="error-panel" class="error fade"></div>
              <div class="form__field">
                <label for="email">Email: </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="Your Email"
                  onchange="validate(this)"
                  onkeyup="validate(this)"
                />
              </div>
              <div class="form__field">
                <label for="password">Password: </label>
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="Your Password"
                  onchange="validate(this)"
                  onkeyup="validate(this)"
                />
              </div>
              <div class="form__field">
                <button type="submit" name="submit" class="btn">Login</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-analytics.js"></script>
    <script src="../js/init.js"></script>
    <script src="../js/utils.js"></script>
    <script>
      const auth = firebase.auth();
      const loginForm = document.querySelector(".login-form");
      const errorBox = document.querySelector("#error-panel");

      window.addEventListener("DOMContentLoaded", () => {
        auth.onAuthStateChanged((user) => {
          if (user) {
            const { email } = user;
            console.log(
              `${email} just logged in. Enjoy the best blog ever....`
            );
            localStorage.setItem("user", JSON.stringify(user));
            redirectTo("/admin/pages/index.html");
          } else {
            disableLoader();
          }
        });
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const email = loginForm.email.value.trim();
          const password = loginForm.password.value.trim();

          if (!email.length || !password.length)
            return showErrorIn(errorBox, "Please fill all fields");

          disableButton(loginForm.submit);
          enableLoader();

          auth.signInWithEmailAndPassword(email, password).catch((err) => {
            let message;
            let time = undefined;
            switch (err.code) {
              case "auth/popup-closed-by-user":
                message = "Network error";
                break;
              case "auth/invalid-email":
              case "auth/user-not-found":
              case "auth/wrong-password":
                message = "Wrong credentials";
                break;
              default:
                message = err.message;
            }
            showErrorIn(errorBox, message);
            enableButton(loginForm.submit);
            disableLoader();
          });
        });
      });
    </script>
  </body>
</html>
